<div id="post" class="container-lg posts">
  <div class="friendURL">
    <div id="Sponsors"></div>
  </div>
  <div id="posts" class="row g-1"></div>
  <div id="pagination">
    <a class='btn btn-warning' href="/?page=posts">Show All Posts</a>
  </div>
</div>

<script>
  document.getElementById('content').classList.remove('regular-page-width');
  document.getElementById('content').classList.add('container-lg');

  var sponsors = getSponsors();
  for (var key in sponsors) document.getElementById('Sponsors').innerHTML += `<u>Ad</u> <a class="URLItself" href="${key}" target="_blank" rel="dofollow">${sponsors[key][0]}</a><br>`;

  $.ajax({
    url: "includes/posts.json",
    type: "GET",
    dataType: "json",
    success: function (posts) {
      posts = posts.slice(0, 20);
      for (var key in posts) {
        if (posts.hasOwnProperty(key)) {
          // Extract the year from the date
          var myDate = new Date(posts[key]['date']);
          const year = myDate.getFullYear();
          var monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
          const month = (monthNames[myDate.getMonth()]);

          let post_title = getPostTitle(posts[key].title);
          let post_url = getPostUrl(posts[key].title);
          let post_date = posts[key].date;
          let post_category = posts[key].category;
          let postExcerpt;
          let wordsCount;
          let readingMinutes;
          
          $.ajax({
            url: `Posts/${year}/${month}/${posts[key]['title']}.txt`,
            type: "GET",
            dataType: "text",
            success: function (post) {
            postExcerpt = post.replace(/<[^>]*>/g, '').substring(0, 200);
            wordsCount = countWords(post);
            readingMinutes = calculateReadingTime(wordsCount);

          $('#posts').append(
            `
            <div class="col-12 col-md-6 col-lg-4">
              <div class="card p-2 m-1">
                <div class="card-title">
                  <a class="postURL" href='${post_url}' rel="dofollow">
                    <h5>${post_title}</h5>
                  </a>
                </div>
                <div class="card-body">
                  <p>${postExcerpt}...</p>
                  <a class="postURL float-end" href='${post_url}' rel="dofollow">
                    Read More
                  </a>
                </div>
                <div class="card-footer">
                  <span>${wordsCount} words</span> | 
                  <span>${readingMinutes} minutes</span><br>
                  <span class="postDate">${post_date}</span>
                  <span class="postCategory">
                    <a class="category" href="?page=category&c=${post_category}">
                      <h5>${post_category}</h5>
                    </a>
                  </span>
                </div>
              </div>
            </div>
        `
          );
        }});
      } 
    }    
    },
    error: function (xhr, status, error) {
      // Handle errors
      console.error('Error loading JSON file:', error);
    },
    complete: function () {
      // This function runs after success or error
      console.log("Request complete.");
    }
  });
</script>